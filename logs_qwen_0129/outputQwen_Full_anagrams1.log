2025-03-04:20:49:09,602 INFO     [huggingface.py:132] Using device 'cpu'
2025-03-04:20:49:09,961 INFO     [huggingface.py:369] Model parallel was set to False, max memory was not set, and device map was set to {'': 'cpu'}
Loading checkpoint shards:   0%|                                                                                                                                                   | 0/8 [00:00<?, ?it/s]Loading checkpoint shards:  12%|█████████████████▍                                                                                                                         | 1/8 [00:00<00:01,  4.09it/s]Loading checkpoint shards:  25%|██████████████████████████████████▊                                                                                                        | 2/8 [00:00<00:01,  4.10it/s]Loading checkpoint shards:  38%|████████████████████████████████████████████████████▏                                                                                      | 3/8 [00:00<00:01,  3.98it/s]Loading checkpoint shards:  50%|█████████████████████████████████████████████████████████████████████▌                                                                     | 4/8 [00:01<00:01,  3.93it/s]Loading checkpoint shards:  62%|██████████████████████████████████████████████████████████████████████████████████████▉                                                    | 5/8 [00:01<00:00,  3.92it/s]Loading checkpoint shards:  75%|████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                  | 6/8 [00:01<00:00,  3.82it/s]Loading checkpoint shards:  88%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                 | 7/8 [00:01<00:00,  3.74it/s]Loading checkpoint shards: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8/8 [00:01<00:00,  4.26it/s]Loading checkpoint shards: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8/8 [00:01<00:00,  4.04it/s]
2025-03-04:20:49:21,069 INFO     [evaluator.py:164] Setting random seed to 0 | Setting numpy seed to 1234 | Setting torch manual seed to 1234 | Setting fewshot manual seed to 1234
2025-03-04:20:49:21,069 INFO     [evaluator.py:217] Using pre-initialized model
all_gate number:24
Downloading data:   0%|                                                                                                                                                       | 0.00/107k [00:00<?, ?B/s]Downloading data:  16%|███████████████████████▏                                                                                                                      | 17.4k/107k [00:00<00:01, 76.0kB/s]Downloading data:  47%|███████████████████████████████████████████████████████████████████▎                                                                           | 50.2k/107k [00:00<00:00, 148kB/s]Downloading data:  78%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                               | 82.9k/107k [00:00<00:00, 204kB/s]Downloading data: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 107k/107k [00:00<00:00, 214kB/s]
Generating validation split: 0 examples [00:00, ? examples/s]Generating validation split: 2919 examples [00:00, 29081.24 examples/s]Generating validation split: 6174 examples [00:00, 31113.34 examples/s]Generating validation split: 9525 examples [00:00, 32203.38 examples/s]Generating validation split: 10000 examples [00:00, 31593.96 examples/s]
2025-03-04:20:49:32,045 WARNING  [task.py:325] [Task: anagrams1] has_training_docs and has_validation_docs are False, using test_docs as fewshot_docs but this is not recommended.
2025-03-04:20:49:32,045 WARNING  [task.py:325] [Task: anagrams1] has_training_docs and has_validation_docs are False, using test_docs as fewshot_docs but this is not recommended.
2025-03-04:20:49:32,305 WARNING  [evaluator.py:270] Overwriting default num_fewshot of anagrams1 from None to 0
2025-03-04:20:49:32,305 INFO     [task.py:415] Building contexts for anagrams1 on rank 0...
  0%|                                                                                                                                                                          | 0/10000 [00:00<?, ?it/s]  2%|███▊                                                                                                                                                          | 245/10000 [00:00<00:03, 2441.19it/s]  5%|███████▋                                                                                                                                                      | 490/10000 [00:00<00:03, 2442.38it/s]  7%|███████████▌                                                                                                                                                  | 735/10000 [00:00<00:03, 2434.58it/s] 10%|███████████████▍                                                                                                                                              | 981/10000 [00:00<00:03, 2443.22it/s] 12%|███████████████████▎                                                                                                                                         | 1228/10000 [00:00<00:03, 2452.20it/s] 15%|███████████████████████▏                                                                                                                                     | 1478/10000 [00:00<00:03, 2468.08it/s] 17%|███████████████████████████▏                                                                                                                                 | 1729/10000 [00:00<00:03, 2480.45it/s] 20%|███████████████████████████████                                                                                                                              | 1978/10000 [00:00<00:03, 2471.43it/s] 22%|██████████████████████████████████▉                                                                                                                          | 2226/10000 [00:00<00:03, 2456.57it/s] 25%|██████████████████████████████████████▊                                                                                                                      | 2472/10000 [00:01<00:03, 2430.92it/s] 27%|██████████████████████████████████████████▋                                                                                                                  | 2716/10000 [00:01<00:02, 2429.34it/s] 30%|██████████████████████████████████████████████▌                                                                                                              | 2963/10000 [00:01<00:02, 2439.75it/s] 32%|██████████████████████████████████████████████████▍                                                                                                          | 3209/10000 [00:01<00:02, 2444.41it/s] 35%|██████████████████████████████████████████████████████▏                                                                                                      | 3455/10000 [00:01<00:02, 2447.74it/s] 37%|██████████████████████████████████████████████████████████                                                                                                   | 3701/10000 [00:01<00:02, 2450.49it/s] 39%|█████████████████████████████████████████████████████████████▉                                                                                               | 3947/10000 [00:01<00:02, 2452.09it/s] 42%|█████████████████████████████████████████████████████████████████▊                                                                                           | 4194/10000 [00:01<00:02, 2456.68it/s] 44%|█████████████████████████████████████████████████████████████████████▊                                                                                       | 4444/10000 [00:01<00:02, 2469.18it/s] 47%|█████████████████████████████████████████████████████████████████████████▋                                                                                   | 4694/10000 [00:01<00:02, 2476.70it/s] 49%|█████████████████████████████████████████████████████████████████████████████▋                                                                               | 4946/10000 [00:02<00:02, 2489.37it/s] 52%|█████████████████████████████████████████████████████████████████████████████████▌                                                                           | 5195/10000 [00:02<00:01, 2469.41it/s] 54%|█████████████████████████████████████████████████████████████████████████████████████▍                                                                       | 5444/10000 [00:02<00:01, 2474.88it/s] 57%|█████████████████████████████████████████████████████████████████████████████████████████▎                                                                   | 5692/10000 [00:02<00:01, 2454.49it/s] 59%|█████████████████████████████████████████████████████████████████████████████████████████████▎                                                               | 5942/10000 [00:02<00:01, 2466.99it/s] 62%|█████████████████████████████████████████████████████████████████████████████████████████████████▎                                                           | 6195/10000 [00:02<00:01, 2485.70it/s] 64%|█████████████████████████████████████████████████████████████████████████████████████████████████████▏                                                       | 6448/10000 [00:02<00:01, 2496.81it/s] 67%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                                   | 6698/10000 [00:02<00:01, 2479.90it/s] 69%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████                                                | 6947/10000 [00:02<00:01, 2470.46it/s] 72%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                            | 7195/10000 [00:02<00:01, 2468.31it/s] 74%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                        | 7443/10000 [00:03<00:01, 2468.97it/s] 77%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                    | 7690/10000 [00:03<00:00, 2464.85it/s] 79%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                | 7937/10000 [00:03<00:00, 2442.75it/s] 82%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                            | 8182/10000 [00:03<00:00, 2406.65it/s] 84%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                        | 8424/10000 [00:03<00:00, 2407.85it/s] 87%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                    | 8673/10000 [00:03<00:00, 2431.34it/s] 89%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                 | 8921/10000 [00:03<00:00, 2443.34it/s] 92%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉             | 9170/10000 [00:03<00:00, 2455.19it/s] 94%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉         | 9421/10000 [00:03<00:00, 2467.50it/s] 97%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉     | 9674/10000 [00:03<00:00, 2485.51it/s] 99%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊ | 9926/10000 [00:04<00:00, 2495.40it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10000/10000 [00:04<00:00, 2460.73it/s]
2025-03-04:20:49:36,633 INFO     [evaluator.py:496] Running generate_until requests
Running generate_until requests:   0%|                                                                                                                                         | 0/10000 [00:00<?, ?it/s]Running generate_until requests:   0%|                                                                                                                               | 1/10000 [00:02<6:36:00,  2.38s/it]Running generate_until requests:   0%|                                                                                                                             | 2/10000 [01:23<134:49:49, 48.55s/it]Running generate_until requests:   0%|                                                                                                                              | 3/10000 [01:24<74:57:17, 26.99s/it]Traceback (most recent call last):
  File "/root/autodl-tmp/lm-evaluation-harness/Qwen_expert_merge_full.py", line 551, in <module>
    results = lm_eval.simple_evaluate( # call simple_evaluate squad_completion
  File "/root/autodl-tmp/lm-evaluation-harness/lm_eval/utils.py", line 402, in _wrapper
    return fn(*args, **kwargs)
  File "/root/autodl-tmp/lm-evaluation-harness/lm_eval/evaluator.py", line 303, in simple_evaluate
    results = evaluate(
  File "/root/autodl-tmp/lm-evaluation-harness/lm_eval/utils.py", line 402, in _wrapper
    return fn(*args, **kwargs)
  File "/root/autodl-tmp/lm-evaluation-harness/lm_eval/evaluator.py", line 507, in evaluate
    resps = getattr(lm, reqtype)(cloned_reqs)
  File "/root/autodl-tmp/lm-evaluation-harness/lm_eval/models/huggingface.py", line 1339, in generate_until
    cont = self._model_generate(
  File "/root/autodl-tmp/lm-evaluation-harness/lm_eval/models/huggingface.py", line 882, in _model_generate
    return self.model.generate(
  File "/root/miniconda3/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/root/autodl-tmp/transformers/src/transformers/generation/utils.py", line 2255, in generate
    result = self._sample(
  File "/root/autodl-tmp/transformers/src/transformers/generation/utils.py", line 3257, in _sample
    outputs = model_forward(**model_inputs, return_dict=True)
  File "/root/miniconda3/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/root/miniconda3/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/root/autodl-tmp/transformers/src/transformers/models/qwen2_moe/modeling_qwen2_moe.py", line 1307, in forward
    outputs = self.model(
  File "/root/miniconda3/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/root/miniconda3/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/root/autodl-tmp/transformers/src/transformers/models/qwen2_moe/modeling_qwen2_moe.py", line 1013, in forward
    layer_outputs = decoder_layer(
  File "/root/miniconda3/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/root/miniconda3/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/root/autodl-tmp/transformers/src/transformers/models/qwen2_moe/modeling_qwen2_moe.py", line 741, in forward
    hidden_states = self.mlp(hidden_states)
  File "/root/miniconda3/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/root/miniconda3/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/root/autodl-tmp/transformers/src/transformers/models/qwen2_moe/modeling_qwen2_moe.py", line 656, in forward
    shared_expert_output = self.shared_expert(hidden_states)
  File "/root/miniconda3/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/root/miniconda3/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/root/autodl-tmp/transformers/src/transformers/models/qwen2_moe/modeling_qwen2_moe.py", line 276, in forward
    return self.down_proj(self.act_fn(self.gate_proj(x)) * self.up_proj(x))
  File "/root/miniconda3/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/root/miniconda3/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/root/miniconda3/lib/python3.10/site-packages/torch/nn/modules/linear.py", line 114, in forward
    return F.linear(input, self.weight, self.bias)
KeyboardInterrupt
